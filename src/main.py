from flask import request
from flask import Flask, render_template, Markup
from datetime import datetime
import http.client
import json
app = Flask(__name__)

@app.route("/")
def homePage():
    return render_template("index.html")

@app.route("/search", methods=["GET"])
def searchCity():
    city = request.args.get('cityName')

    conn = http.client.HTTPSConnection("yahoo-weather5.p.rapidapi.com")

    headers = {
        'x-rapidapi-host': "yahoo-weather5.p.rapidapi.com",
        'x-rapidapi-key': "4e123d79e0msh363a306f33604eep18d837jsn5b2e54116b09"
        }

    conn.request("GET", '/weather?location='+city+'&format=json&u=f', headers=headers)

    res = conn.getresponse()
    data = res.read().decode('utf-8')
    json_obj = json.loads(data)
    name = json_obj['location']['city'] + ", " + json_obj['location']['country']
    
    temp = str(int((json_obj['current_observation']['condition']['temperature']-32)/1.8)) + " Â°C"
    num = int((json_obj['current_observation']['condition']['temperature']-32)/1.8)

    if num<28:
        url="https://gray-wsfa-prod.cdn.arcpublishing.com/resizer/DfEB5tnIrOoQXOfB8TRiWoxmdjI=/1200x675/smart/filters:quality(85)/cloudfront-us-east-1.images.arcpublishing.com/gray/GMNTPXU3CZBS3PSWM5BMQWYM5Y.jpg"
    elif num>=35:
        url="data:image/jpeg;base64,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"


    ts = int(json_obj['current_observation']['pubDate'])
    time = str(datetime.utcfromtimestamp(ts).strftime('%Y-%m-%d %H:%M:%S'))


    return render_template("result.html", name=name, temp=temp, ts=time, img=url)



